app-id: net.baseart.Glide
runtime: org.gnome.Platform
runtime-version: '45'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
cleanup:
  - /include
command: glide
finish-args:
  - --device=dri
  - --filesystem=xdg-download:ro
  - --filesystem=xdg-videos:ro
  - --filesystem=xdg-music:ro
  - --share=ipc
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --socket=wayland
build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
  env:
    CARGO_HOME: /run/build/glide/cargo
modules:
  - name: ffmpeg
    builddir: true
    sources:
      - type: git
        url: https://git.ffmpeg.org/ffmpeg.git
        branch: release/6.0
        commit: 511b8444232376db4b03edb4306a3c18995f0576
    config-opts:
      - --prefix="/app/"
      - --libdir="/app/lib"
      - --disable-doc
      - --disable-static
      - --enable-optimizations
      - --enable-shared
      - --disable-everything
      - --disable-ffplay
      - --disable-ffprobe
      - --enable-gnutls
      - --enable-libaom
      - --enable-libdav1d
      - --enable-libfdk-aac
      - --enable-libmp3lame
      - --enable-libfontconfig
      - --enable-libfreetype
      - --enable-libopenh264
      - --enable-libopus
      - --enable-libpulse
      - --enable-libspeex
      - --enable-libtheora
      - --enable-libvorbis
      - --enable-libvpx
      - --enable-libwebp
      - --enable-openal
      - --enable-opengl
      - --enable-decoder=ac3,eac3,alac,flac,g723_1,g729,libfdk_aac,libopus,mp2,mp3,m4a,pcm_alaw,pcm_mulaw,pcm_f32le,pcm_s16be,pcm_s24be,pcm_s16le,pcm_s24le,pcm_s32le,pcm_u8,tta,vorbis,wavpack
      - --enable-decoder=ass,ffv1,libaom_av1,libdav1d,libopenh264,libvpx_vp8,libvpx_vp9,rawvideo,theora,vp8,vp9,flv,hevc,h263,h264,mpeg2video,mpeg4,msmpeg4,msmpeg4v1,msmpeg4v2,msmpeg4v3,vp6,vp6a,vp6f
      - --enable-decoder=gif,png,tiff,webp
      - --enable-parser=aac,ac3,flac,mpegaudio,mpeg4video,opus,vp3,vp8,vorbis,hevc,h264
      - --enable-demuxer=aac,ac3,ass,flac,gif,matroska,mov,mp3,mpegvideo,ogg,wav
      - --enable-filter=crop,scale
      - --enable-protocol=file

  - name: gstreamer
    builddir: true
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/gstreamer/gstreamer
        tag: 1.24.0
        disable-submodules: true
    config-opts:
      - -Ddoc=disabled
      - -Dtests=disabled
      - -Ddevtools=disabled
      - -Dges=disabled
      - -Drtsp_server=disabled
      - -Dgst-examples=disabled
      - -Dpython=disabled
      - -Dwebrtc=disabled
      - -Dgpl=enabled
      - -Dgst-plugins-ugly:gpl=enabled
      - -Dgst-plugins-bad:gpl=enabled

  - name: glide
    buildsystem: meson
    sources:
      - type: archive
        url: https://github.com/philn/glide/releases/download/0.6.2/glide-0.6.2.tar.xz
        sha256: 8d8e350043c0e9633667b6ffa62bcf7fea96ea8b3a8d6c9bde85702f2b634ccd
        x-checker-data:
          type: json
          url: https://api.github.com/repos/philn/glide/releases/latest
          version-query: .tag_name | sub("^glide-"; "")
          url-query: .assets[] | select(.name=="glide-" + $version + ".tar.xz") |
            .browser_download_url
      - type: patch
        path: 0001-metainfo-Add-branding-colors.patch
